<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PromptTree — AIに伝わるディレクトリ構成図メーカー</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Inter',sans-serif; transition: background-color 0.3s,color 0.3s; }
body.dark { background-color:#1a202c; color:#e2e8f0; }
textarea.sample-active { background-color:#f0f0f0; color:#888; } /* サンプル表示中 */
textarea.user-input { background-color:#fff; color:inherit; }       /* 入力中 */
</style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

<!-- ヘッダー -->
<header class="bg-white shadow-sm p-4 sticky top-0 z-10 rounded-b-lg flex justify-between items-center">
  <div>
    <h1 class="text-2xl font-bold text-blue-600">PromptTree</h1>
    <p class="text-sm text-gray-600 dark:text-gray-400">AIに正確に伝わるディレクトリ構成図メーカー — コードやドキュメント作成を効率化</p>
  </div>
  <button id="darkModeToggle" class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600">🌙</button>
</header>

<main class="flex-grow container mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-2 gap-6">

<!-- 説明文 -->
<section class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
  <h2 class="text-xl font-semibold mb-3">PromptTreeの目的・魅力</h2>
  <ul class="list-disc pl-5 text-gray-700 dark:text-gray-300">
    <li>複雑なディレクトリ構造をAIに正確に伝えるのが簡単になる</li>
    <li>READMEや技術ブログ、プレゼン資料に活用可能</li>
    <li>サンプル表示/非表示で直感的に学習・確認できる</li>
    <li>Markdownや絵文字を簡単に切替え可能</li>
  </ul>
</section>

<!-- 入力 -->
<section class="bg-white p-6 rounded-lg shadow-md">
  <h2 class="text-xl font-semibold mb-4">入力 (インデントで階層表現)</h2>
  <textarea id="inputText" class="w-full h-64 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 sample-active"></textarea>

  <div class="mt-4 flex flex-wrap gap-3">
    <button id="sampleButton" class="flex-1 min-w-[120px] bg-indigo-500 hover:bg-indigo-600 text-white py-2 px-4 rounded-lg">サンプル非表示</button>
    <button id="clearButton" class="flex-1 min-w-[120px] bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">全削除</button>
    <div class="flex-1 min-w-[120px] flex items-center bg-gray-100 rounded-lg p-2">
      <span class="mr-2 text-sm">絵文字</span>
      <input type="checkbox" id="emojiToggle">
    </div>
    <div class="flex-1 min-w-[120px] flex items-center bg-gray-100 rounded-lg p-2">
      <span class="mr-2 text-sm">Markdown</span>
      <input type="checkbox" id="markdownToggle">
    </div>
  </div>
</section>

<!-- 出力 -->
<section class="bg-white p-6 rounded-lg shadow-md">
  <h2 class="text-xl font-semibold mb-4">出力 (生成された構成図)</h2>
  <pre id="outputCode" class="w-full h-64 p-3 border border-gray-300 rounded-lg bg-gray-100 overflow-auto text-sm whitespace-pre-wrap break-words"></pre>
  <div class="mt-4 flex justify-end gap-2">
    <button id="copyButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">コピー</button>
  </div>
  <div id="copyMessage" class="mt-2 text-center text-sm text-green-600 hidden">コピーしました！</div>
</section>

</main>

<footer class="bg-white shadow-inner p-4 mt-6 rounded-t-lg text-center text-gray-600 dark:text-gray-400">
&copy; 2025 PromptTree. All rights reserved.
</footer>

<script>
// ----------------------
// DOM取得
// ----------------------
const inputText = document.getElementById('inputText');
const outputCode = document.getElementById('outputCode');
const sampleButton = document.getElementById('sampleButton');
const clearButton = document.getElementById('clearButton');
const copyButton = document.getElementById('copyButton');
const emojiToggle = document.getElementById('emojiToggle');
const markdownToggle = document.getElementById('markdownToggle');
const darkModeToggle = document.getElementById('darkModeToggle');
const copyMessage = document.getElementById('copyMessage');

// サンプルテキスト
const sampleText = `my_project
  src
    components
      Header.jsx
      Footer.jsx
    pages
      index.jsx
      about.jsx
  README.md
  package.json`;

// 状態管理
let sampleVisible = true;
let originalInput = '';

// ----------------------
// UI更新
// ----------------------
function updateSampleUI(){
  if(sampleVisible){
    inputText.classList.add('sample-active');
    inputText.classList.remove('user-input');
    sampleButton.textContent = "サンプル非表示";
  } else {
    inputText.classList.remove('sample-active');
    inputText.classList.add('user-input');
    sampleButton.textContent = "サンプル表示";
  }
}

// ----------------------
// ツリー生成
// ----------------------
function generateTree(){
  if(!inputText.value.trim()){ outputCode.textContent=''; return; }

  const lines = inputText.value.split('\n').filter(l=>l.trim()!=='');
  const useEmoji = emojiToggle.checked;
  let output=[];

  const parsed = lines.map(line=>{
    const indent = line.match(/^\s*/)[0].length/2;
    return {indent, name: line.trim()};
  });

  for(let i=0;i<parsed.length;i++){
    const cur = parsed[i];
    let prefix='';
    for(let j=0;j<cur.indent;j++){
      let hasSibling=false;
      for(let k=i+1;k<parsed.length;k++){
        if(parsed[k].indent===j){ hasSibling=true; break; }
        if(parsed[k].indent<j) break;
      }
      prefix += hasSibling ? '│   ' : '    ';
    }
    let isLast=true;
    for(let k=i+1;k<parsed.length;k++){
      if(parsed[k].indent===cur.indent){ isLast=false; break; }
      if(parsed[k].indent<cur.indent) break;
    }
    const linePrefix = cur.indent>0 ? (isLast ? '└── ':'├── ') : '';
    const icon = useEmoji ? (cur.name.includes('.')?'📄 ':'📁 ') : '';
    output.push(`${prefix}${linePrefix}${icon}${cur.name}`);
  }

  let text = output.join('\n');
  if(markdownToggle.checked) text='```\n'+text+'\n```';
  outputCode.textContent = text;
}

// ----------------------
// Tabキーでインデント
// ----------------------
inputText.addEventListener('keydown', function(e){
  if(e.key==='Tab'){
    e.preventDefault();
    const start=this.selectionStart;
    const end=this.selectionEnd;
    this.value=this.value.substring(0,start)+'  '+this.value.substring(end);
    this.selectionStart=this.selectionEnd=start+2;
    generateTree();
  }
});

// ----------------------
// 入力開始でサンプル非表示
// ----------------------
inputText.addEventListener('input', ()=>{
  if(sampleVisible){
    originalInput='';
    hideSample();
  } else {
    originalInput = inputText.value;
    generateTree();
  }
});

// ----------------------
// サンプル表示 / 非表示
// ----------------------
function showSample(){
  sampleVisible=true;
  inputText.value = sampleText;
  originalInput='';
  updateSampleUI();
  generateTree();
}
function hideSample(){
  sampleVisible=false;
  inputText.value = originalInput;
  updateSampleUI();
  generateTree();
}
sampleButton.addEventListener('click', ()=>{ sampleVisible?hideSample():showSample(); });

// ----------------------
// 全削除
// ----------------------
clearButton.addEventListener('click', ()=>{
  inputText.value='';
  outputCode.textContent='';
  sampleVisible=false;
  originalInput='';
  updateSampleUI();
});

// ----------------------
// コピー
// ----------------------
copyButton.addEventListener('click', ()=>{
  const ta=document.createElement('textarea');
  ta.value=outputCode.textContent;
  document.body.appendChild(ta);
  ta.select();
  document.execCommand('copy');
  document.body.removeChild(ta);
  copyMessage.classList.remove('hidden');
  setTimeout(()=>copyMessage.classList.add('hidden'),2000);
});

// ----------------------
// Markdown切替・Emoji切替
// ----------------------
markdownToggle.addEventListener('change', generateTree);
emojiToggle.addEventListener('change', generateTree);

// ----------------------
// ダークモード
// ----------------------
darkModeToggle.addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
  localStorage.setItem('darkMode', document.body.classList.contains('dark'));
});
function applyInitialDarkMode(){
  const saved = localStorage.getItem('darkMode');
  if(saved==='true') document.body.classList.add('dark');
  else if(!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)
    document.body.classList.add('dark');
}

// 初期化
window.onload = ()=>{
  applyInitialDarkMode();
  showSample();
};
</script>
</body>
</html>
